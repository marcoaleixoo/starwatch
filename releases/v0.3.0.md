# v0.3.0 — Biblioteca de Scripts + HAL Tools

Data: 2025-09-23

Objetivo: dar vida aos scripts de verdade. Nesta release, introduzimos uma Biblioteca de Scripts persistente no jogo, ampliamos o conjunto de ferramentas do HAL para CRUD de scripts, e evoluímos a aba “Scripts” para um mini‑IDE com lista, edição, salvar, executar e excluir.

## Principais mudanças

- Game
  - Biblioteca de Scripts persistente (`localStorage`), incluindo seed com `patrol.js`.
  - Novos métodos públicos:
    - `listScripts()`, `getScriptCode(name)`
    - `createScript(name, code, description?)`, `updateScript(name, newCode)`, `deleteScript(name)`
    - `runScriptByName(name)` (execução a partir da biblioteca)
  - `runScript(job)` permanece internamente; execução padrão agora busca o código pelo nome.

- HAL (LLM Bridge)
  - `BridgeTools` expande com CRUD da biblioteca e `runScript(name)`.
  - Novo protocolo de intenções para scripts:
    - `list_scripts`, `get_script_code`, `delete_script`, `run_script { name }`
    - `create_script { name, goal, description? }` e `update_script { name, goal }`
  - Geração/edição de código ocorre dentro da própria tool (via `ai` SDK): a tool recebe o objetivo (`goal`) e chama `generateText` internamente (até ~15 steps) para produzir/atualizar o script, seguindo a API disponível no worker (`Game.moveTo`, `Memory`, `sleep`).

- UI
  - Nova `ScriptsPanel`: lista de scripts (sidebar), descrição, editor (Monaco), ações de Novo/Salvar/Executar/Excluir.
  - A aba “Scripts” agora reflete o estado real da biblioteca.

## Como usar

- Criação por voz (via HAL):
  - “HAL, crie um script chamado mine_iron.js que encontre o asteroide de ferro mais próximo e o minere até esgotar.”
  - O HAL usa `create_script { name, goal }` e salva na biblioteca. Depois, peça “Execute mine_iron.js”.

- Edição iterativa:
  - “HAL, modifique mine_iron.js para retornar à base (0,0,0) após a mineração.”
  - O HAL usa `update_script { name, goal }`, reescreve o código com base no atual e salva.

- Execução:
  - “HAL, execute patrol.js.” → `run_script { name: 'patrol.js' }`.
  - Também é possível executar pela aba “Scripts”.

## Notas de compatibilidade

- Persistência: scripts salvos em `localStorage` em `starwatch.v030.scripts`.
- Setor continua salvo em `starwatch.v020.save`.
- É recomendável definir `OPENAI_API_KEY` e `OPENAI_MODEL` (padrão: `gpt-4o-mini`).

## Passos de teste manual

1. Dev server: `pnpm dev` (http://localhost:5173)
2. Aba Scripts:
   - Verifique a presença de `patrol.js` (seed).
   - Crie `hello.js`, edite e salve; recarregue a lista (Atualizar).
   - Execute `hello.js` (verificar execução no jogo).
   - Exclua `hello.js` e confirme remoção.
3. Com‑Link (HAL):
   - “Liste os scripts.” → Deve retornar os nomes.
   - “Crie um script mine_iron.js que busque e minere ferro.”
   - “Execute mine_iron.js.”
   - “Atualize mine_iron.js para retornar a (0,0,0) ao finalizar.”

## Próximos passos sugeridos

- Histórico/console de execução por script (logs do worker).
- Anotações de tipos leves para a API do worker visíveis no editor.
- Melhoria de prompts de geração com contexto do setor/mineração.
- Suporte a múltiplos arquivos por script (futuro).

